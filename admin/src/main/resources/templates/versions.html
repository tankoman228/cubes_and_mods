<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin panel - Tariffs</title>
	<script src="/public/libs/chart.js"></script>

	<script src="/public/libs/vue.js"></script>
	<script src="/public/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/public/bootstrap/js/bootstrap-vue.min.js"></script>
    <script src="/public/libs/axios.js"></script>
    <script src="/public/libs/toasted.js"></script>

	<link href="/public/style.css" rel="stylesheet">
    <link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/public/toast_style.css" rel="stylesheet">
</head>
<body class="d-flex flex-column vh-100 bg-light">
    <div id="app">

        <nav class="navbar navbar-expand-lg px-4 d-flex align-items-center" style="height: 8vh; background-color: #e9ecef;">
            <a href="/home">
                <img src="/public/icons/home.png" style="height: 3vh; margin-right: 1vw;"></img>
            </a>
            <span class="navbar-brand fs-3 fw-bold me-3">Управление игровыми версиями</span>
        </nav>

        <b-card class=" p-4 w-100">
            <b-tabs content-class="mt-3">
                <b-tab title="Версии">
                    <div class="d-flex mb-3">
                        <b-form-group>
                            <button @click="showAddModal" class="btn btn-primary">Загрузить версию</button>
                        </b-form-group>
                        <b-form-group>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </b-form-group>
                        <b-form-group label="Выберите игру:" class="mb-3">
                            <b-form-select v-model="form.idGame" :options="games" value-field="id" text-field="name" @change="fetchVersions"></b-form-select>
                        </b-form-group>
                    </div>
        
                    <b-table :items="versions" :fields="tableFields" bordered>
                        <template #cell(actions)="row">
                            <b-button size="sm" variant="info" @click="downloadArchive(row.item.id)">Скачать</b-button>
                            <b-button size="sm" variant="warning" @click="editVersion(row.item)">Редактировать</b-button>
                            <b-button size="sm" variant="danger" @click="deleteVersion(row.item.id)">Удалить</b-button>
                        </template>
                    </b-table>   
                </b-tab>
                <b-tab title="Игры">
                    <b-button class="mb-3" @click="showAddGameModal">Добавить игру</b-button>

                    <b-table :items="games" :fields="gameFields" bordered>
                        <template #cell(actions)="row">
                            <b-button size="sm" variant="warning" @click="editGame(row.item)">Редактировать</b-button>
                            <b-button size="sm" variant="danger" @click="deleteGame(row.item.id)">Удалить</b-button>
                        </template>
                    </b-table>
                </b-tab>
            </b-tabs>
        </b-card>

        <b-modal id="uploadModal" title="Загрузить версию" @ok="submitUpload" hide-header-close>
            <b-form enctype="multipart/form-data">
                <b-form-group label="Название">
                    <b-form-input v-model="form.name" required></b-form-input>
                </b-form-group>
                <b-form-group label="Описание">
                    <b-form-textarea v-model="form.description" rows="3"></b-form-textarea>
                </b-form-group>

                <b-form-group label="Игра (ID)">
                    <b-form-input v-model="form.idGame" type="number" required></b-form-input>
                </b-form-group>
                <b-form-group label="Игра">
                    <b-form-select v-model="form.idGame" :options="games" value-field="id" text-field="name"></b-form-select>
                </b-form-group>

                <b-form-group label="Архив (.zip)">
                    <input type="file" class="form-control" ref="archiveFile" required>
                </b-form-group>
            </b-form>
        </b-modal>

        <b-modal id="gameModal" :title="editingGame ? 'Редактировать игру' : 'Добавить игру'" @ok="submitGame" hide-header-close>
            <b-form>
                <b-form-group label="Название">
                    <b-form-input v-model="gameForm.name" required></b-form-input>
                </b-form-group>
                <b-form-group label="Описание">
                    <b-form-textarea v-model="gameForm.description" rows="3"></b-form-textarea>
                </b-form-group>
            </b-form>
        </b-modal> 
    </div>

    <div th:insert="footer.html :: footer"></div>
    <script type="module" src="/public/js/versions.js"></script>
</body>
</html>