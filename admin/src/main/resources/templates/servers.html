<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin panel - Servers</title>
	<script src="/public/libs/chart.js"></script>
    
	<script src="/public/libs/vue.js"></script>
	<script src="/public/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/public/bootstrap/js/bootstrap-vue.min.js"></script>
    <script src="/public/libs/axios.js"></script>
    <script src="/public/libs/toasted.js"></script>
	<link href="/public/style.css" rel="stylesheet">
    <link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/public/toast_style.css" rel="stylesheet">
</head>
<body class="d-flex flex-column vh-100 bg-light">
    <div id="app">
        <h1>Cubes & Mods (Управление серверами)</h1>
        
        <b-button variant="primary" @click="showAddModal">Добавить сервер</b-button>
        
        <b-table striped hover :items="servers" :fields="fields" @row-dblclicked="editServer">
            <template #cell(resources)="data">
                <div>CPU: {{ data.item.cpu_threads_free }}/{{ data.item.cpu_threads }}</div>
                <div>RAM: {{ data.item.ram_free }}/{{ data.item.ram }} MB</div>
                <div>Память: {{ data.item.memory_free }}/{{ data.item.memory }} MB</div>
            </template>
            <template #cell(actions)="row">
                <b-button size="sm" @click="editServer(row.item)" class="mr-1">
                    Редактировать
                </b-button>
                <b-button size="sm" variant="danger" @click="confirmDelete(row.item)">
                    Удалить
                </b-button>
            </template>
        </b-table>

        <b-modal v-model="showModal" :title="modalTitle" @hidden="resetModal">
            <b-form @submit.prevent="saveServer">
                <b-form-group label="Название сервера">
                    <b-form-input v-model="currentServer.name" required></b-form-input>
                </b-form-group>
                
                <b-form-group label="Адрес">
                    <b-form-input v-model="currentServer.address"></b-form-input>
                </b-form-group>
                
                <b-form-group label="Модель CPU">
                    <b-form-input v-model="currentServer.cpu_name" required></b-form-input>
                </b-form-group>
                
                <b-form-group label="Всего CPU Threads">
                    <b-form-input v-model="currentServer.cpu_threads" type="number" required
                                  @change="showResourceWarning"></b-form-input>
                </b-form-group>
                
                <b-form-group label="Всего RAM (MB)">
                    <b-form-input v-model="currentServer.ram" type="number" required
                                  @change="showResourceWarning"></b-form-input>
                </b-form-group>
                
                <b-form-group label="Всего памяти (MB)">
                    <b-form-input v-model="currentServer.memory" type="number" required
                                  @change="showResourceWarning"></b-form-input>
                </b-form-group>
                
                <b-alert variant="warning" show v-if="showWarning">
                    Внимание! Изменение ресурсов может нарушить работу существующих инстансов!
                </b-alert>

                <div class="mt-3">
                    <b-button type="submit" variant="primary">Сохранить</b-button>
                    <b-button @click="showModal = false" variant="secondary">Отмена</b-button>
                </div>
            </b-form>
        </b-modal>
    </div>

    <div th:insert="footer.html :: footer"></div>
    <script type="module" src="/public/js/servers.js"></script>
</body>
</html>